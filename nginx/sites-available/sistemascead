server {
    listen 80;
    server_name sistemascead.ufjf.br;
    return 301 https://$host$request_uri;
}

server {
    listen 443 ssl;
    server_name sistemascead.ufjf.br;

    ssl_certificate /etc/nginx/ssl/sistemascead.ufjf.br.crt;
    ssl_certificate_key /etc/nginx/ssl/sistemascead.ufjf.br.key;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;

    error_log /var/log/nginx/error-sistemascead.log;
    access_log /var/log/nginx/access-sistemascead.log;

    error_page 413 = @413_payload_too_large;

    location @413_payload_too_large {
        default_type application/json;
        return 413 '{"detail": "Arquivo excede limite de tamanho. Entre em contato com o suporte tecnol√≥gico do CEAD: suporte.cead@ufjf.br"}';
    }

    proxy_next_upstream error timeout http_502 http_503 http_504;
    error_page 502 503 504 http://www.cead.ufjf.br/5xx.html;

    location = /proceg/inscricao/editaiscorrentes.zul {
        return 301 https://sistemascead.ufjf.br/inscricao/;
    }

    location = /proceg/inscricao/justificativa.zul {
        return 301 https://sistemascead.ufjf.br/editais/justificativa/;
    }

    location /proceg {
        return 301 https://sistemascead.ufjf.br/;
    }

    location = /fichauab/ {
        return 301 https://sistemascead.ufjf.br/ficha/;
    }

    location = /lancaFrequencia/ {
        return 301 https://sistemascead.ufjf.br/;
    }

    location = /backend {
        return 301 /;
    }

    location /arquivos/ {
        internal;
        alias /media/truenas/proceg/documentos/;
    }

    location /backend/static/ {
        proxy_pass http://127.0.0.1:8080/backend/static/;
    }

    location /backend/docs/ {
        proxy_pass http://127.0.0.1:8080/backend/docs/;
    }

    location /backend/ {
        proxy_pass http://127.0.0.1:8000/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header Authorization $http_authorization;
    }

    location / {
        proxy_pass http://127.0.0.1:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
